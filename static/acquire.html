<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <title>Tor Browser Screenshot Acquisition</title>
  </head>
  <body>
    <script>
     let handleMessage = (e) => {
       let { state, locale, imageName } = JSON.parse(e.data);
       switch (state) {
         case "acquired":
           document.body.innerHTML += `<p><img src='/final/${locale}/${imageName}.png'></p>`;
       };
     };
     let socket;
     (async () => {
       socket = new WebSocket("ws://localhost:3000/websocket");
       await new Promise(resolve => { socket.onopen = resolve; });
       socket.onmessage = handleMessage;
     })();

     let send = obj => socket.send(JSON.stringify(obj));

     let acquire = () => {
       let details = JSON.parse(document.cookie);
       send(Object.assign({"cmd":"acquire"}, details));
     };

     addEventListener("load", () => {
       let { imageName } = JSON.parse(document.cookie);
       let firstImage = document.getElementById("firstImage");
       firstImage.src = `/final/en-US/${imageName}.png`;
     });
    </script>
    <h1>Tor Browser Screenshot Acquisition</h1>
    <img id="firstImage">
    <p>Click here to start:
      <button id="acquire" onclick="acquire();">
        Acquire!
      </button>
    </p>
  </body>
</html>
